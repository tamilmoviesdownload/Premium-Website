<!doctype html>
<html>
<head><meta charset="utf-8"><title>Sign Up</title></head>
<body style="font-family: Georgia, serif;">
  <h2>Sign Up (Username + Password)</h2>
  <input id="username" placeholder="Choose a username" /><br/><br/>
  <input id="password" placeholder="Password" type="password" /><br/><br/>
  <button id="btnSign">Sign Up</button>
  <p>Already have an account? <a href="/login.html">Login</a></p>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="/firebase-config.js"></script>
<script>
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // helper: create a private synthetic email from username
  function syntheticEmail(username) {
    const safe = username.replace(/[^a-zA-Z0-9]/g, '_').toLowerCase();
    return `${safe}@premium-website-0628.local`;
  }

  document.getElementById('btnSign').addEventListener('click', async () => {
    const username = (document.getElementById('username').value || '').trim();
    const password = (document.getElementById('password').value || '').trim();
    if (!username || !password) return alert('Enter username and password');
    const email = syntheticEmail(username);
    try {
      // Create Auth user
      const userCred = await auth.createUserWithEmailAndPassword(email, password);
      const uid = userCred.user.uid;
      // store username mapping, isPremium false by default
      await db.collection('users').doc(uid).set({
        username,
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        isPremium: false,
        expiryDate: null
      });
      alert('Account created! Please login and redeem your code to get access.');
      window.location = '/login.html';
    } catch (err) {
      alert(err.message);
    }
  });
</script>
</body>
</html>
